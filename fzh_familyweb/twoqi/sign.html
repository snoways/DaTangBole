<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<title>注册</title>
		<script src="../../fzh_teacherweb/js/com.js" ></script>
		<link rel="stylesheet" href="../../fzh_teacherweb/css/weui.min.css" />
		<link rel="stylesheet" href="../../fzh_teacherweb/css/jquery-weui.css" />
		<link rel="stylesheet" href="../../fzh_teacherweb/css/stylea.css" />
		<script src="../../fzh_teacherweb/js/jquery.min.js" ></script>
		<script src="../../fzh_teacherweb/js/jquery-weui.js"></script>
		<script src="../../fzh_teacherweb/js/md5.js"></script>
		<script src="../../fzh_teacherweb/js/city-picker.js"></script>
		<script src="../../fzh_teacherweb/js/swiper_jqueryweui.js"></script>
	</head>
	<body>

		<!-- 老师端 商家端 注册只需要走第一步就行，剩下的步骤，可以在个人中心传-->
		<div class="header txt_center bgcolorfff color666 border_b font14">
			<div class="tableblock">
				<div class="col-xs-4 pad_t10 pad_b10 tabitem colorzt border_bzt2" onclick="tabitemclick(0)">
					家长端
				</div>
				<!-- <div class="col-xs-4 pad_t10 pad_b10 tabitem" onclick="tabitemclick(1)">
					老师端
				</div>-->
				<!--<div class="col-xs-4 pad_t10 pad_b10 tabitem" onclick="tabitemclick(2)">-->
					<!--商家端-->
				<!--</div>-->
			</div>
		</div>

		<div class="content_box pad_tou" style="background: #efefef">
			<div class="content_scroll">

				<div style="padding:0 20px" class="font14">
					<div class="tableblock border_b">
						<div>
							<div style="padding: 20px 0 20px 10px">
								<input type="text" placeholder="手机号" id="phone" class="w100">
							</div>
						</div>
						<div class="wrem7 txt_right">
							<a href="javascript:;" class="colorzt font12 wrem6 txt_center inblock" id="getma" style="border:1px solid #ff6000;border-radius: 100px">获取验证码</a>
						</div>
					</div>
					<div class="tableblock">
						<div>
							<div class="border_b" style="padding: 20px 10px">
								<input type="text" placeholder="验证码" id="yzm" class="w100">
							</div>
						</div>
					</div>
					<div class="tableblock">
						<div>
							<div class="border_b" style="padding: 20px 10px">
								<input type="password" placeholder="设置密码" id="pwd1" class="w100">
							</div>
						</div>
					</div>
					<div class="tableblock">
						<div>
							<div class="border_b" style="padding: 20px 10px">
								<input type="password" placeholder="确认密码" id="pwd2" class="w100">
							</div>
						</div>
					</div>
					<!-- 选择所属管辖区 问过了，不写-->

					<!--&lt;!&ndash; 老师端注册显示&ndash;&gt;-->
					<!--<div id="tab2content" style="display: none">-->
						<!--<div class="tableblock border_b">-->
							<!--<div class="wrem5">-->
								<!--<div class="pad_l10 color666">身份</div>-->
							<!--</div>-->
							<!--<div>-->
								<!--<div class="font14 color666" style="padding: 20px 10px">-->
									<!--<label class="mar_r10">-->
										<!--<input type="radio" name="teachertype" value="1" class="my_radio">-->
										<!--<span class="inblock">家教</span>-->
									<!--</label>-->
									<!--<label class="mar_r10">-->
										<!--<input type="radio" name="teachertype" value="2" class="my_radio">-->
										<!--<span class="inblock">老师</span>-->
									<!--</label>-->
									<!--<label class="mar_r10">-->
										<!--<input type="radio" name="teachertype" value="3" class="my_radio">-->
										<!--<span class="inblock">外教</span>-->
									<!--</label>-->
								<!--</div>-->
							<!--</div>-->
						<!--</div>-->
						<!--<div class="tableblock">-->
							<!--<div>-->
								<!--<div class="border_b" style="padding: 20px 10px">-->
									<!--<input type="text" placeholder="选择省市区" id="shengshiqu" class="w100">-->
								<!--</div>-->
							<!--</div>-->
						<!--</div>-->
						<!--<div class="tableblock">-->
							<!--<div>-->
								<!--<div class="border_b" style="padding: 20px 10px">-->
									<!--<input type="text" placeholder="填写详细地址" id="address" class="w100">-->
								<!--</div>-->
							<!--</div>-->
						<!--</div>-->
					<!--</div>-->


					<!-- 商家端注册显示-->
					<!--<div id="tab3content" style="display: none">-->
						<!--<div class="tableblock border_b">-->
							<!--<div class="wrem5">-->
								<!--<div class="pad_l10 color666">身份</div>-->
							<!--</div>-->
							<!--<div>-->
								<!--<div class="font14 color666" style="padding: 20px 10px">-->
									<!--<label class="mar_r10">-->
										<!--<input type="radio" name="shoptype" value="1" class="my_radio">-->
										<!--<span class="inblock">托管</span>-->
									<!--</label>-->
									<!--<label class="mar_r10">-->
										<!--<input type="radio" name="shoptype" value="2" class="my_radio">-->
										<!--<span class="inblock">教育机构</span>-->
									<!--</label>-->
								<!--</div>-->
							<!--</div>-->
						<!--</div>-->
					<!--</div>-->

					<div class="font12 color999" style="padding:20px 0 20px 10px">
						<input type="checkbox" class="my_checkbox mar_r5" id="agree">
						<span class="inblock">
							我已阅读并同意<a href="plat.html" class="color666">《平台服务协议》</a>
						</span>
					</div>
					<div>
						<a href="javascript:queding();" class="block font15 colorfff txt_center bgcolorzt pad_t10 pad_b10" style="border-radius: 100px;">确认注册</a>
					</div>

					<!--<div class="clear" style="padding: 50px 0 20px 0;">-->
						<!--<div class="col-xs-6 L">-->
							<!--<div class="pad_l10 pad_r10">-->
								<!--<div>-->
									<!--<div style="width: 80%;margin:0 auto">-->
										<!--<div class="img_box img100">-->
											<!--<div class="img_content">-->
												<!--<img src='../img/alpha.png' class="imgone" id="iosimg" onclick="imginit(0)" style="background: red">-->
											<!--</div>-->
										<!--</div>-->
									<!--</div>-->
								<!--</div>-->
								<!--<a class="font13 colorzt txt_center pad_t5 pad_b5 mar_t10 block" style="border:2px solid #ff6000;border-radius: 100px;" href="#" id="ioslink">-->
									<!--<img src="../img/ios.png" height="17" class="mar_r5" alt="">-->
									<!--<span class="inblock">IOS客户端下载</span>-->
								<!--</a>-->
							<!--</div>-->
						<!--</div>-->
						<!--<div class="col-xs-6 L">-->
							<!--<div class="pad_l10 pad_r10">-->
								<!--<div>-->
									<!--<div style="width: 80%;margin:0 auto">-->
										<!--<div class="img_box img100">-->
											<!--<div class="img_content">-->
												<!--<img src='../img/alpha.png' class="imgone" id="adrimg" onclick="imginit(1)" style="background: red">-->
											<!--</div>-->
										<!--</div>-->
									<!--</div>-->
								<!--</div>-->
								<!--<a class="font13 colorzt txt_center pad_t5 pad_b5 mar_t10 block" style="border:2px solid #ff6000;border-radius: 100px;" href="#" id="adrlink">-->
									<!--<img src="../img/adr.png" height="17" class="mar_r5" alt="">-->
									<!--<span class="inblock">Andriod客户端</span>-->
								<!--</a>-->
							<!--</div>-->
						<!--</div>-->
					<!--</div>-->
					 <!--<div class="txt_center color999 font12 pad_b10">请点击二维码放大后识别</div>-->

				</div>

			</div>
		</div>

		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=VEhxujiyti0FA7GlHA8enmLkYlp0m3Wx"></script>
		<script>
			var data={oprate:true};

			//家长端-个人中心 分享二维码页面 扫码后 会跳到这个页面携带code
			var familycode='';
			if(Getvariable('code')){
				familycode=Getvariable('code');
			}

			function cityinit(){
				$("#shengshiqu").cityPicker({
					title: "请选择省市区"
				});
			}

			var jingweidu='';
			function getjingweidu(){
				// 百度地图API功能-浏览器定位-获取经纬度
				var geolocation = new BMap.Geolocation();
				geolocation.getCurrentPosition(function(r){
					if(this.getStatus() == BMAP_STATUS_SUCCESS){
						var mk = new BMap.Marker(r.point);
//						alert('您的位置：'+r.point.lng+','+r.point.lat);
						jingweidu=r.point.lng+','+r.point.lat;
					}
					else {
						alert('failed'+this.getStatus());
					}
				},{enableHighAccuracy: true})
			}
			getjingweidu();

			//获取验证码
			var timer=null;
			var sumt=60;
			var currt=sumt;
			$('#getma').click(function(){
				if(!data.oprate){
					return false;
				}

				if($('#getma').text()=='获取验证码' || $('#getma').text()=='重新发送'){
					var phone=$('#phone').val();
					if(phone==''){
						$.toast('请输入手机号','text');
						return false;
					}
					if(!checktel(phone)){
						$.toast('手机号不正确','text');
						return false;
					}

					data.oprate=false;
					//发短信前的验证码
					$.ajax({
						url:path_inter+"Client/common/getImgCode",
						dataType:'json',
						type:'post',
						data:{phone:phone},
						success:function(res){
							data.oprate=true;
							if(user_overdue(res.code,res.msg)){
								//从第三位开始，截取四位数字
								var zhi=res.data.code;
								zhi=zhi.substr(2,4);

								data.oprate=false;
								//发短信
								$.ajax({
									url:path_inter+"Client/common/sendMsg",
									dataType:'json',
									type:'post',
									data:{phone:phone,img_code:zhi},
									success:function(res){
										data.oprate=true;
										if(user_overdue(res.code,res.msg)){
											$.toast('发送成功');

											//倒计时操作
											currt--;
											$('#getma').text(currt+'s');
											timer=setInterval(function(){
												if(currt>1){
													currt--;
													$('#getma').text(currt+'s');
												}else{
													clearInterval(timer);
													timer=null;
													currt=sumt;
													$('#getma').text('重新发送');
												}
											},1000);

										}
									},
									error:function(){
										data.oprate=true;
										pre_loading(1);
									}
								});

							}
						},
						error:function(){
							data.oprate=true;
							pre_loading(1);
						}
					});


				}
			});


			//一开始 初始化为 家长端二维码和链接
			$('#ioslink').attr('href',familylink_ios);
			$('#adrlink').attr('href',familylink_adr);
			$('#iosimg').attr('src',familyma_ios);
			$('#adrimg').attr('src',familyma_adr);

			var tabindex=0;
			function tabitemclick(index){
				$('.tabitem').removeClass('colorzt border_bzt2');
				$('.tabitem').eq(index).addClass('colorzt border_bzt2');
				tabindex=index;

				//获取二维码和链接
				var adrimg,adrlink,iosimg,ioslink;
				if(index==0){
					//家长端
					adrimg=familyma_adr;
					iosimg=familyma_ios;
					adrlink=familylink_adr;
					ioslink=familylink_ios;
					$('#tab2content').hide();
					$('#tab3content').hide();
				}else if(index==1){
					//老师端
					adrimg=teacherma_adr;
					iosimg=teacherma_ios;
					adrlink=teacherlink_adr;
					ioslink=teacherlink_ios;
					$('#tab2content').show();
					$('#tab3content').hide();

					cityinit();
				}else if(index==2){
					//商家端
					adrimg=shangjiama_adr;
					iosimg=shangjiama_ios;
					adrlink=shangjialink_adr;
					ioslink=shangjialink_ios;
					$('#tab2content').hide();
					$('#tab3content').show();
				}
				$('#adrimg').attr('src',adrimg);
				$('#adrlink').attr('href',adrlink);
				$('#iosimg').attr('src',iosimg);
				$('#ioslink').attr('href',ioslink);
			}
			function queding(){
				if(!data.oprate){
					return false;
				}
				
				var phone=$('#phone').val();
				var yzm=$('#yzm').val();
				var pwd1=$('#pwd1').val();
				var pwd2=$('#pwd2').val();
				var agree=$('#agree:checked').length>0?true:false;
				if(phone==''){
					$.toast('请输入手机号','text');
					return false;
				}
				if(!checktel(phone)){
					$.toast('手机号不正确','text');
					return false;
				}
				if(yzm==''){
					$.toast('请输入验证码','text');
					return false;
				}
				if(pwd1==''){
					$.toast('请设置密码','text');
					return false;
				}
				if(pwd1.length<6){
					$.toast('密码不少于6位','text');
					return false;
				}
				if(pwd2==''){
					$.toast('请确认密码','text');
					return false;
				}
				if(pwd1!=pwd2){
					$.toast('两次密码不一致','text');
					return false;
				}

				if(tabindex==1){
					
					//老师端
					if($('input[name=teachertype]:checked').length==0){
						$.toast('请选择身份','text');
						return false;
					}
					var teachertype=$('input[name=teachertype]:checked').val();

					var address=$('#address').val();
					var shengshiqu=$('#shengshiqu').val();
					if(shengshiqu==''){
						$.toast('请选择省市区','text');
						return false;
					}
					if(address==''){
						$.toast('请填写详细地址','text');
						return false;
					}
					var shengshiquarr=shengshiqu.split(' ');
					var sheng=shengshiquarr[0];
					var shi=shengshiquarr[1];
					var qu=shengshiquarr[2];
				}else if(tabindex==2){
					if($('input[name=shoptype]:checked').length==0){
						$.toast('请选择身份','text');
						return false;
					}
					var shoptype=$('input[name=shoptype]:checked').val();
				}

				if(!agree){
					$.toast('请同意协议','text');
					return false;
				}

				var empnum=Getvariable('empnum');//后台 在url中 传了empnum这个参数
				var parentId = Getvariable('parent_id');
				if(tabindex==0){
					
					//家长端注册
					var chuan={phone:phone,password:hex_md5(pwd1+'fzm'),code:yzm,empnum:empnum,parent_id:parentId};
					if(familycode!=''){
						chuan.invitation_code=familycode;
					}

					data.oprate=false;
					$.ajax({
						url:path_inter+"parents/auth/reg",
						dataType:'json',
						type:'post',
						data:chuan,
						success:function(res){
							data.oprate=true;
							if(user_overdue(res.code,res.msg)){
								$.toast('注册成功');
								window.location.href = "erweima.html"
							}
							
						},
						error:function(){
							data.oprate=true;
							pre_loading(1);
						}
					});
				}else if(tabindex==1){
					//老师端注册
					data.oprate=false;
					$.ajax({
						url:path_inter+"Teacher/Auth/register",
						dataType:'json',
						type:'post',
						data:{
							t_type:teachertype,
							phone:phone,
							code:yzm,
							password_one:pwd1,
							password_two:pwd2,
							province:sheng,
							city:shi,
							area:qu,
							type:1,
							position:jingweidu,//经纬度 用逗号隔开
							address:address,
							empnum:empnum
						},
						success:function(res){
							data.oprate=true;
							if(user_overdue(res.code,res.msg)){
								$.toast('注册成功');
							}
						},
						error:function(){
							data.oprate=true;
							pre_loading(1);
						}
					});
				}else if(tabindex==2){
					//商家端注册
					data.oprate=false;
					$.ajax({
						url:path_inter+"ManagedClient/Auth/register",
						dataType:'json',
						type:'post',
						data:{phone:phone,password:hex_md5(pwd1),code:yzm,s_type:shoptype,empnum:empnum},
						success:function(res){
							data.oprate=true;
							if(user_overdue(res.code,res.msg)){
								$.toast('注册成功');
							}
						},
						error:function(){
							data.oprate=true;
							pre_loading(1);
						}
					});
				}

			}
			function imginit(index){
				var pb1 = $.photoBrowser({
					items: [
						$('#iosimg').attr('src'),
						$('#adrimg').attr('src')
					],
					initIndex:index
				});
				pb1.open();
			}
		</script>
	</body>
</html>
